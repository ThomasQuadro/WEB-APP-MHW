server {
    listen 8000;
    server_name _;

    # ── GoTrue — authentification (/auth/v1/*) ─────────────────────────────────
    location /auth/v1/ {
        rewrite ^/auth/v1/(.*) /$1 break;
        proxy_pass         http://auth:9999;
        proxy_http_version 1.1;
        proxy_set_header   Host              $host;
        proxy_set_header   X-Real-IP         $remote_addr;
        proxy_set_header   X-Forwarded-For   $proxy_add_x_forwarded_for;
        proxy_set_header   X-Forwarded-Proto $scheme;
    }

    # ── PostgREST — accès base de données (/rest/v1/*) ────────────────────────
    location /rest/v1/ {
        rewrite ^/rest/v1/(.*) /$1 break;
        proxy_pass         http://rest:3000;
        proxy_http_version 1.1;
        proxy_set_header   Host          $host;
        proxy_set_header   Authorization $http_authorization;
        proxy_set_header   apikey        $http_apikey;
        proxy_set_header   X-Real-IP     $remote_addr;
    }
}
